(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"6wu/":function(e,t){e.exports="form {\n  padding-top: 2rem;\n  padding-bottom: 1rem;\n  max-width: 700px;\n  margin: auto; }\n  form .field {\n    margin-bottom: 2rem; }\n  form .field label {\n      font-size: 90%;\n      display: block; }\n  form .field .control, form .field .control input {\n      width: 100%; }\n  form .field nb-select ::ng-deep [nbButton] {\n      height: 46px;\n      border-color: #dadfe6;\n      text-transform: capitalize; }\n  .consult-wrapper .options .filter {\n  font-size: 90%;\n  border-radius: 5px;\n  border: 1px solid #ebeff5; }\n  .consult-wrapper .options .filter, .consult-wrapper .options .filter * {\n    display: flex;\n    align-items: center; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep label {\n    padding: 0; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep .customised-control-description {\n    display: none; }\n  .consult-wrapper .data {\n  font-size: 85%; }\n  .consult-wrapper .data tr:hover {\n    background-color: #f8fafd; }\n  .consult-wrapper .data thead tr:hover {\n    background-color: transparent; }\n  .consult-wrapper .data th, .consult-wrapper .data td {\n    vertical-align: middle; }\n  .consult-wrapper .options .btn-secondary, .consult-wrapper .data .actions .btn-secondary {\n  cursor: pointer; }\n  .consult-wrapper .options .btn-secondary:hover, .consult-wrapper .data .actions .btn-secondary:hover {\n    color: #ffffff;\n    background-color: #40dc7e; }\n"},Ceb0:function(e,t){e.exports='<div class="row">\n  <div class="col">\n    <nb-card>\n      <nb-card-body>        \n        <nb-tabset fullWidth>\n\n          \x3c!-- Offrir un financement --\x3e\n          <nb-tab tabTitle="Offrir" tabIcon="nb-heart">\n            <form [formGroup]="form" (ngSubmit)="onSubmit()">\n              <nb-alert class="bottom col-md-12" status="{{ status }}" *ngIf="isSend" fullWidth closable (close)="onClose()">\n                {{ message }}\n              </nb-alert>\n              <div class="row">\n\n                <div class="field col-md-12">\n                  <label>Vous disposez de {{ montantDispo }} Euro disponible</label>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>Date d\'\xe9mission </label>\n                  <div class="control">\n                    <input formControlName="dateEmission" [nbDatepicker]="dateEmission" nbInput/>\n                    <nb-datepicker #dateEmission></nb-datepicker>\n                  </div>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>Date de cl\xf4ture </label>\n                  <div class="control">\n                    <input formControlName="dateCloture" [nbDatepicker]="dateCloture" nbInput/>\n                    <nb-datepicker #dateCloture></nb-datepicker>\n                  </div>\n                </div>\n              </div>\n\n              <div class="row">\n                <div class="field col-md-6">\n                  <label>Montant </label>\n                  <div class="control">\n                    <input type="number" formControlName="montant" min="0" nbInput>\n                  </div>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>R\xe9mun\xe9ration </label>\n                  <div class="control">\n                    <input type="number" formControlName="remuneration" nbInput/>\n                  </div>\n                </div>\n              </div>\n\n              <div class="row">\n                  <div class="field col-md-6">\n                      <div class="filter p-2 control">\n                        <span class="mr-2">L\'offre est-elle secable ?</span>\n                        <nb-checkbox status="success" formControlName="secable">\n                        </nb-checkbox>\n                      </div>\n                  </div>\n  \n                  <div class="field col-md-6">\n                      <div class="filter p-2 control">\n                        <span class="mr-2">L\'offre est-elle extensible ?</span>\n                        <nb-checkbox status="success" formControlName="extensible">\n                        </nb-checkbox>\n                      </div>\n                  </div>\n              </div>\n              <button status="success" type="submit"\n               fullWidth nbButton>\n                Valider\n              </button>\n\n            </form>\n          </nb-tab>\n\n          \x3c!-- Consulter les offres de financement --\x3e\n          <nb-tab tabTitle="Consulter" tabIcon="nb-lightbulb">\n            <div class="consult-wrapper mt-4 px-4">\n            \n              <div class="options d-flex align-center mb-4">\n\n                <div class="ml-auto">\n                  <button nbButton class="btn-secondary" size="xsmall" shape="round"\n                   (click)="fetchMyOffers()">\n                    Rafra\xeechir\n                  </button>\n                </div>               \n                \n              </div>\n\n              <div class="data table-responsive" >\n                <table class="table table-hover table-bordered">\n                  \n                  <thead>\n                    <tr>\n                      <th scope="col">#</th>\n                      <th scope="col">Date d\'\xe9mission</th>\n                      <th scope="col">Date de cloture</th>\n                      <th scope="col">Montant</th>\n                      <th scope="col">R\xe9mun\xe9ration</th>\n                      <th scope="col">Secable</th>\n                      <th scope="col">Extensible</th>\n                      <th scope="col">Actions</th>\n                    </tr>\n                  </thead>\n\n                  <tbody>\n                    <ng-container *ngFor="let offer of offers">\n\n                      <tr>\n                        <th scope="row">{{ offer.idOffreFinancement }}</th>\n                        <td>{{ formatDate(offer.dateEmission) }}</td>\n                        <td>{{ formatDate(offer.dateCloture) }}</td>\n                        <td class="text-right">{{ offer.montant.toLocaleString(\'fr\') }}</td>\n                        <td class="text-right">{{ offer.remuneration.toLocaleString(\'fr\') }}</td>\n                        <td>{{ offer.secable ? \'Oui\' : \'Non\' }}</td>\n                        <td>{{ offer.extensible ? \'Oui\' : \'Non\' }}</td>\n\n                        <td class="actions text-center">\n                          <a nbButton class="btn-secondary" size="xsmall" shape="round" [routerLink]="[\'/pfm/funding/couverture\', offer.idOffreFinancement]">\n                            Couvertures\n                          </a>\n                        </td>\n\n                      </tr>\n                      \n                    </ng-container>\n                  </tbody>\n                </table>\n              </div>\n  \n            </div>\n          </nb-tab>\n\n        </nb-tabset>\n      </nb-card-body>\n    </nb-card>\n  </div>\n</div>\n    '},HRzy:function(e,t){e.exports='<div class="row">\n    <div class="col">\n      <nb-card>\n        <nb-card-body>        \n          <nb-tabset fullWidth>\n\n  \n            \x3c!-- Consulter les demandes de financement --\x3e\n            <nb-tab tabTitle="Proposition d\'offres de financement" tabIcon="nb-lightbulb">\n              <div class="consult-wrapper mt-4 px-4">\n              \n                <div class="options d-flex align-center mb-4">\n             \n                  \n                </div>\n  \n                <div class="data table-responsive" *ngIf="offresFinancement">\n                  <table class="table table-hover table-bordered">\n                    \n                    <thead>\n                      <tr>\n                        <th scope="col" class="text-center">Periode</th>\n                        <th scope="col" class="text-center">Auteur</th>\n                        <th scope="col" class="text-center">Ouverture</th>\n                        <th scope="col" class="text-center">Clot\xfbre</th>\n                        <th scope="col" class="text-center">Montant</th>\n                        <th scope="col" class="text-center">R\xe9mun\xe9ration</th>\n                        <th scope="col" class="text-center">S\xe9cable</th>\n                        <th scope="col" class="text-center">Extensible</th>\n                        <th scope="col" class="text-center">Actions</th>\n                      </tr>\n                    </thead>\n  \n                    <tbody>\n                      <ng-container *ngFor="let el of offresFinancement; let i = index">\n  \n                        <tr *ngIf="(!selfFilter || (el.utilisateur.idUtilisateur === currentUserId)) && !isCovered(el, i+1) && el != null" style="background-color: #8be9b773;">\n                          <th scope="row" class="text-center">{{ i+1 }}</th>\n                          <td>{{ el.utilisateur.prenomUtilisateur + " " + el.utilisateur.nomUtilisateur }}</td>\n                          <td>{{ formatDate(el.dateEmission) }}</td>\n                          <td>{{ formatDate(el.dateCloture) }}</td>\n                          <td class="text-right">{{ el.montant.toLocaleString(\'fr\') }}</td>\n                          <td class="text-right">{{ el.remuneration.toLocaleString(\'fr\') }}</td>\n                          <td class="text-center">{{ el.secable ? \'OUI\' : \'NON\' }}</td>\n                          <td class="text-center">{{ el.extensible ? \'OUI\' : \'NON\' }}</td>\n  \n                          <td class="actions text-center">\n                            <button nbButton class="btn-secondary" (click)="validerOffre(el, i+1)" size="xsmall" shape="round">\n                              Valider\n                            </button>\n                          </td>\n                        </tr>\n                      </ng-container>\n                    </tbody>\n                  </table>\n                </div>\n                <div class="data table-responsive" *ngIf="!offresFinancement">\n                    <h1 class="text-center">Aucune combinaison d\'offres de financement a proposer</h1>\n                </div>\n    \n              </div>\n            </nb-tab>\n\n            <nb-tab tabTitle="Selection d\'offres de financement" tabIcon="nb-lightbulb">\n              <form [formGroup]="periodeForm" (ngSubmit)="parPeriode()">\n                <nb-alert class="bottom col-md-12" status="{{ status }}" *ngIf="isSend" fullWidth closable (close)="onClose()">\n                  {{ message }}\n                </nb-alert>\n                <div class="row">\n                  <div class="field col-md-12" fullWidth>\n                    <label>Numero de la periode</label>\n                    <div class="control" fullWidth>\n                      <input type="number" min="1" max="{{ numberPeriode }}" step="1" fullWidth formControlName="periode" nbInput>\n                    </div>\n                  </div>\n                  <div class="field col-md-12" fullWidth>\n                    <div class="control" fullWidth>\n                      <button status="success" type="submit" fullWidth nbButton>\n                        Rechercher\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </form>\n\n              <div class="data table-responsive" *ngIf="offresFinancementPeriode">\n                <table class="table table-hover table-bordered">\n                  \n                  <thead>\n                    <tr>\n                      <th scope="col" class="text-center">Auteur</th>\n                      <th scope="col" class="text-center">Ouverture</th>\n                      <th scope="col" class="text-center">Clot\xfbre</th>\n                      <th scope="col" class="text-center">Montant</th>\n                      <th scope="col" class="text-center">R\xe9mun\xe9ration</th>\n                      <th scope="col" class="text-center">S\xe9cable</th>\n                      <th scope="col" class="text-center">Extensible</th>\n                      <th scope="col" class="text-center">Actions</th>\n                    </tr>\n                  </thead>\n\n                  <tbody>\n                    <ng-container *ngFor="let el of offresFinancementPeriode">\n\n                      <tr *ngIf="(!selfFilter || (el.utilisateur.idUtilisateur === currentUserId)) && !isCovered(el, periode)">\n                        <td>{{ el.utilisateur.prenomUtilisateur + " " + el.utilisateur.nomUtilisateur }}</td>\n                        <td>{{ formatDate(el.dateEmission) }}</td>\n                        <td>{{ formatDate(el.dateCloture) }}</td>\n                        <td class="text-right">{{ el.montant.toLocaleString(\'fr\') }}</td>\n                        <td class="text-right">{{ el.remuneration.toLocaleString(\'fr\') }}</td>\n                        <td class="text-center">{{ el.secable ? \'OUI\' : \'NON\' }}</td>\n                        <td class="text-center">{{ el.extensible ? \'OUI\' : \'NON\' }}</td>\n\n                        <td class="actions text-center">\n                          <button nbButton class="btn-secondary" (click)="validerOffre(el, periode)" size="xsmall" shape="round">\n                            Valider\n                          </button>\n                        </td>\n                      </tr>\n                    </ng-container>\n                  </tbody>\n                </table>\n              </div>\n            </nb-tab>\n  \n            <nb-tab tabTitle="Etat du contrat de la demande" tabIcon="nb-list">\n              <div class="consult-wrapper mt-4 px-4">\n              \n                <div class="options d-flex align-center mb-4">           \n                  \n                </div>\n  \n                <div class="data table-responsive" *ngIf="offresFinancement">\n                  <table class="table table-hover table-bordered">\n                    \n                    <thead>\n                      <tr>\n                        <th scope="col" class="text-center">Periode</th>\n                        <th scope="col" class="text-center">Ouverture</th>\n                        <th scope="col" class="text-center">Clot\xfbre</th>\n                        <th scope="col" class="text-center">Montant</th>\n                        <th scope="col" class="text-center">R\xe9mun\xe9ration</th>\n                        <th scope="col" class="text-center">Limite de payement</th>\n                        <th scope="col" class="text-center">Actions</th>\n                      </tr>\n                    </thead>\n  \n                    <tbody>\n                      <ng-container *ngFor="let el of couvertures">\n  \n                        <tr *ngIf="!selfFilter || (el.utilisateur.idUtilisateur === currentUserId)">\n                          <th class="text-center" scope="row">{{ el.periode }}</th>\n                          <td class="text-center">{{ formatDate(el.offre.dateEmission) }}</td>\n                          <td class="text-center">{{ formatDate(el.offre.dateCloture) }}</td>\n                          <td class="text-center">{{ el.offre.montant.toLocaleString(\'fr\') }}</td>\n                          <td class="text-center">{{ el.remuneration.toLocaleString(\'fr\') }}</td>\n                          <td class="text-center">{{ formatDate(el.dateRemboursement) }}</td>\n  \n                          <td class="actions text-center">\n                            <button nbButton class="btn-secondary" *ngIf="!el.nanti" sytle="background-color: #d65252" (click)="nantirCouvre(el)" size="xsmall" shape="round">\n                              Nantir\n                            </button>\n                            <button nbButton class="btn-secondary" *ngIf="!el.nanti" sytle="background-color: #d65252" (click)="annulerOffre(el)" size="xsmall" shape="round">\n                              Annuler\n                            </button>\n                            <button nbButton class="btn-secondary" *ngIf="el.nanti && el.montantVerse < el.baseRemuneration"  (click)="openRemboursement(rembourser, el)" sytle="background-color: #d65252" size="xsmall" shape="round">\n                              Rembourser\n                            </button>\n                            <button nbButton class="btn-secondary" *ngIf="el.nanti && el.montantVerse >= el.baseRemuneration" sytle="background-color: #d65252" (click)="annulerOffre(el)" size="xsmall" shape="round">\n                              Supprimer\n                            </button>\n                          </td>\n  \n                        </tr>\n                        \n                      </ng-container>\n                    </tbody>\n                  </table>\n                </div>\n                <div class="data table-responsive" *ngIf="!offresFinancement">\n                    <h1 class="text-center">Aucune combinaison d\'offres de financement a proposer</h1>\n                </div>\n    \n              </div>\n            </nb-tab>\n          </nb-tabset>\n        </nb-card-body>\n      </nb-card>\n    </div>\n  </div>\n      \n\n  <ng-template #rembourser let-modal size="lg">\n    <div class="modal-header">\n        <h4 class="modal-title" id="modal-basic-title">Remboursement de couverture</h4>\n        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss(\'Cross click\')">\n          <span aria-hidden="true">&times;</span>\n        </button>\n    </div>\n    <div class="modal-body" style="min-height: 300px; max-height: 600px; overflow-y: auto;">\n        <p>Vous devez encore rembourser {{ couvre.baseRemuneration - couvre.montantVerse }} Euro</p>\n        <p>Le solde de votre compte est de: {{ compte != null ? compte.solde : \'0\' }} Euro</p>\n        <div class="field modalField col-md-12">\n          <form [formGroup]="rembourserForm" (ngSubmit)="onRem(); modal.close(\'Save click\')">\n            <div class="row">\n              <div class="field col-md-12">\n                <label>Montant a verser </label>\n                <div class="control">\n                  <input type="number" formControlName="montant" nbInput>\n                </div>\n              </div>\n            </div>\n            <button status="success" type="submit" fullWidth nbButton>\n              Valider\n            </button>\n          </form>\n        </div>\n    </div>\n    <div class="modal-footer">\n      <button type="button" class="btn btn-outline-dark" (click)="modal.close(\'Save click\')">Annuler</button>\n    </div>\n  </ng-template>'},IV5l:function(e,t){e.exports="form {\n  padding-top: 2rem;\n  padding-bottom: 1rem;\n  max-width: 700px;\n  margin: auto; }\n  form .field {\n    margin-bottom: 2rem; }\n  form .field label {\n      font-size: 90%;\n      display: block; }\n  form .field .control, form .field .control input {\n      width: 100%; }\n  form .field nb-select ::ng-deep [nbButton] {\n      height: 46px;\n      border-color: #dadfe6;\n      text-transform: capitalize; }\n  .consult-wrapper .options .filter {\n  font-size: 90%;\n  border-radius: 5px;\n  border: 1px solid #ebeff5; }\n  .consult-wrapper .options .filter, .consult-wrapper .options .filter * {\n    display: flex;\n    align-items: center; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep label {\n    padding: 0; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep .customised-control-description {\n    display: none; }\n  .consult-wrapper .data {\n  font-size: 85%; }\n  .consult-wrapper .data tr:hover {\n    background-color: #f8fafd; }\n  .consult-wrapper .data thead tr:hover {\n    background-color: transparent; }\n  .consult-wrapper .data th, .consult-wrapper .data td {\n    vertical-align: middle; }\n  .consult-wrapper .data .pagination-wrapper .page-item .page-link:hover {\n    background-color: #f8fafd; }\n  .consult-wrapper .data .pagination-wrapper .page-item.active .page-link {\n    border-color: #3dcc6d;\n    background-color: #3dcc6d; }\n  .consult-wrapper .options .btn-secondary, .consult-wrapper .data .actions .btn-secondary {\n  cursor: pointer; }\n  .consult-wrapper .options .btn-secondary:hover, .consult-wrapper .data .actions .btn-secondary:hover {\n    color: #ffffff;\n    background-color: #40dc7e; }\n"},PBCG:function(e,t){e.exports="<router-outlet></router-outlet>\n"},ZGPs:function(e,t){e.exports="form {\n  padding-top: 2rem;\n  padding-bottom: 1rem;\n  max-width: 700px;\n  margin: auto; }\n  form .field {\n    margin-bottom: 2rem; }\n  form .field label {\n      font-size: 90%;\n      display: block; }\n  form .field .control, form .field .control input {\n      width: 100%; }\n  form .field nb-select ::ng-deep [nbButton] {\n      height: 46px;\n      border-color: #dadfe6;\n      text-transform: capitalize; }\n  .consult-wrapper .options .filter {\n  font-size: 90%;\n  border-radius: 5px;\n  border: 1px solid #ebeff5; }\n  .consult-wrapper .options .filter, .consult-wrapper .options .filter * {\n    display: flex;\n    align-items: center; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep label {\n    padding: 0; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep .customised-control-description {\n    display: none; }\n  .consult-wrapper .options .btn-secondary {\n  cursor: pointer; }\n  .consult-wrapper .options .btn-secondary:hover {\n    color: #ffffff;\n    background-color: #40dc7e; }\n  .consult-wrapper .options .btn-danger {\n  color: #ffffff;\n  background-color: #d65252; }\n  .consult-wrapper .data {\n  font-size: 85%; }\n  .consult-wrapper .data tr:hover {\n    background-color: #f8fafd; }\n  .consult-wrapper .data thead tr:hover {\n    background-color: transparent; }\n"},bWmn:function(e,t){e.exports=""},icE9:function(e,t,n){"use strict";n.r(t);var r=n("mrSG"),o=n("CcnG"),i=n("Ip0R"),s=n("xkgV"),a=n("4GxJ"),c=n("Xk95"),l=n("ZtdT"),d=n("NT7v"),u=n("HBUA"),f=n("ZYCi"),m=function(){function e(e,t){this.route=e,this.pfmComp=t}return e.prototype.ngOnInit=function(){var e=this;this.route.data.subscribe(function(t){return e.data=t}),this.data.activateMenu&&(this.pfmComp.menu=u.a),l.replace()},e.ctorParameters=function(){return[{type:f.a},{type:d.a}]},e=r.c([Object(o.n)({selector:"fundingComponent",template:n("PBCG"),styles:[n("bWmn")]}),r.f("design:paramtypes",[f.a,d.a])],e)}(),p=n("gIcY"),h=function(){function e(e){return Object.assign(this,e)}return e.ctorParameters=function(){return[{type:void 0}]},e}(),b=n("qfBg"),v=n("xCfu"),g=function(){function e(e,t,n,r){this.router=e,this.formBuilder=t,this.userService=n,this.demandeFinancementService=r,this.logger={isOk:!1,message:"",color:""},this.isSend=!1,this.message="",this.status="success",this.selfFilter=!1,this.demandesFinancement=[],this.currentPage=0,this.totalPages=0,this.loadedPages=[-1],this.defaultPageSize=10}return e.prototype.ngOnInit=function(){this.getUser(),this.initForm()},e.prototype.getUser=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.userService.getCurrentUser().then(function(t){return e.currentUserId=t.idUtilisateur,e.profile=t,e.fetchDemandesFinancement(0),e.getTypeAmortissement(),!0}).catch(function(e){return alert("Problem to get User from database "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})})},e.prototype.onClose=function(){this.isSend=!1},e.prototype.initForm=function(){this.demandeFinancementForm=this.formBuilder.group({dateOuverture:"",dateCloture:"",montant:"",dureeAmortissement:"",typeAmortissement:"",periodeAmortissement:"",remuneration:"",titre:"Demande financement",etatFinancement:0,nombreActifEquivalent:0,utilisateur:""})},e.prototype.getTypeAmortissement=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.demandeFinancementService.getTypeAmortissement().then(function(t){return e.typeAmortissement=t,!0}).catch(function(e){return alert("Problem to get TypeAmortissement "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})})},e.prototype.fetchDemandesFinancement=function(e){return void 0===e&&(e=0),r.b(this,void 0,void 0,function(){var t,n,o,i,s=this;return r.e(this,function(a){switch(a.label){case 0:t=Math.max.apply(Math,this.loadedPages),n=function(e){return r.e(this,function(t){switch(t.label){case 0:return[4,o.demandeFinancementService.fetchDemandesFinancement(e,o.defaultPageSize,o.currentUserId).then(function(t){var n;return(n=s.demandesFinancement).push.apply(n,t.content),s.loadedPages.push(e),0===s.totalPages&&(s.totalPages=t.totalPages),!0}).catch(function(e){return alert("Problem to get all financements "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})},o=this,i=t+1,a.label=1;case 1:return i<=e?[5,n(i)]:[3,4];case 2:a.sent(),a.label=3;case 3:return++i,[3,1];case 4:return[2]}})})},e.prototype.envoieDemandeFinancement=function(){return r.b(this,void 0,void 0,function(){var e,t,n,o=this;return r.e(this,function(r){switch(r.label){case 0:for(e=this.typeAmortissement.length,t=0;t<e&&this.typeAmortissement[t].codeValue!=this.demandeFinancementForm.value.typeAmortissement;)t+=1;return(n=new h(this.demandeFinancementForm.value)).typeAmortissement=this.typeAmortissement[t],n.utilisateur=this.profile,[4,this.demandeFinancementService.addDemandeFinancement(n).then(function(e){return o.logger.message="Offre enregistr\xe9e avec succ\xe8s",o.logger.isOk=!0,o.logger.color="primary",o.initForm(),o.fetchDemandesFinancement(),o.isSend=!0,o.status="success",o.message="L'op\xe9ration s'est deroul\xe9e avec succ\xe8s !",!0}).catch(function(e){return o.isSend=!0,o.status="danger",o.message=e.error.message,!1})];case 1:return r.sent(),[2]}})})},e.prototype.loadPage=function(e){var t=this;this.fetchDemandesFinancement(e).then(function(){t.currentPage=e}).catch(function(){console.error("Couldn't load page",e)})},e.prototype.refresh=function(){this.demandesFinancement=[],this.loadedPages=[-1],this.loadPage(0)},e.prototype.formatDate=function(e){return new Date(e).toLocaleString()},e.prototype.arrayRange=function(e){return Array.from(Array(e).keys())},e.ctorParameters=function(){return[{type:f.c},{type:p.c},{type:b.a},{type:v.a}]},e=r.c([Object(o.n)({selector:"demandeFinancement",template:n("s0HC"),styles:[n("IV5l")]}),r.f("design:paramtypes",[f.c,p.c,b.a,v.a])],e)}(),y=n("t/Na"),x=n("AytR"),F={headers:new y.e({"Content-Type":"application/json","Access-Control-Allow-Origin":"*"})},w=function(){function e(e){this.http=e,this.url=x.a.serverEndpoint+"/funding/demandes-financements/",this.urlOffreUtilisateur=x.a.serverEndpoint+"/funding/offres",this.urlValidation=x.a.serverEndpoint+"/funding/couvres",this.urlOffresUtilisateur=x.a.serverEndpoint+"/funding/utilisateurs/"}return e.prototype.fetchPropositionOffreFinancement=function(e){return this.http.get(this.url+e+"/proposing",F).toPromise()},e.prototype.fetchPropositionOffreFinancementPeriode=function(e,t){return this.http.get(this.url+e+"/proposing/"+t+"/periode",F).toPromise()},e.prototype.sendOffreFinancement=function(e){return this.http.post(this.urlOffreUtilisateur,e,F).toPromise()},e.prototype.fetchUserOffresFinancement=function(e){return this.http.get(this.urlOffresUtilisateur+e+"/offres",F).toPromise()},e.prototype.validerOffre=function(e){return this.http.post(this.urlValidation,e,F).toPromise()},e.prototype.nantirCouvre=function(e,t){return this.http.put(this.urlValidation+"/"+t,e,F).toPromise()},e.prototype.rembourserCouvre=function(e,t,n){return this.http.post(this.urlValidation+"/rembourser/"+t+"/"+n,e,F).toPromise()},e.prototype.deleteCouvre=function(e){return this.http.delete(this.urlValidation+"/"+e,F).toPromise()},e.ctorParameters=function(){return[{type:y.b}]},e=r.c([Object(o.D)({providedIn:"root"}),r.f("design:paramtypes",[y.b])],e)}(),O=function(){function e(e){return Object.assign(this,e)}return e.ctorParameters=function(){return[{type:void 0}]},e}(),P=function(){function e(e,t,n){this.formBuilder=e,this.offreFinancementService=t,this.userService=n,this.logger={isOk:!1,message:"",color:""},this.selfFilter=!1,this.isSend=!1,this.message="",this.status="success"}return e.prototype.ngOnInit=function(){this.initForm(),this.getUser()},e.prototype.onClose=function(){this.isSend=!1},e.prototype.getUser=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.userService.getCurrentUser().then(function(t){return e.user=t,e.getAccount(),!0}).catch(function(e){return alert("Problem to get User from database "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})})},e.prototype.initForm=function(){this.form=this.formBuilder.group({dateEmission:"",dateCloture:"",montant:"",remuneration:"",secable:"",extensible:"",utilisateur:""})},e.prototype.fetchMyOffers=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.offreFinancementService.fetchUserOffresFinancement(this.user.idUtilisateur).then(function(t){t=t.reverse(),e.offers=t}).catch(function(e){return alert("Problem to get All All Offre Financement "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})})},e.prototype.getAccount=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.userService.getCurrentAccount(this.user.idUtilisateur).then(function(t){return e.compte=t,e.getAmount(),!0}).catch(function(e){return alert("Problem to get compte from database "),!1})];case 1:return t.sent(),[2]}})})},e.prototype.getAmount=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.userService.bgDisponible(this.compte).then(function(t){return e.montantDispo=t,!0}).catch(function(e){return alert("Problem to get amount from database "),!1})];case 1:return t.sent(),[2]}})})},e.prototype.onSubmit=function(){return r.b(this,void 0,void 0,function(){var e,t=this;return r.e(this,function(n){switch(n.label){case 0:return this.form.value.montant>this.montantDispo?(this.isSend=!0,this.status="danger",this.message="Le montant maximal \xe0 proposer a \xe9t\xe9 depass\xe9, veuillez acheter d'autre BGs",[2]):(this.form.value.dateEmission=this.dateToTimestamp(this.form.value.dateEmission),this.form.value.dateCloture=this.dateToTimestamp(this.form.value.dateCloture),(e=new O(this.form.value)).utilisateur=this.user,[4,this.offreFinancementService.sendOffreFinancement(e).then(function(e){return t.logger.message="Offre enregistr\xe9e avec succ\xe8s",t.logger.isOk=!0,t.logger.color="primary",t.initForm(),t.fetchMyOffers(),t.isSend=!0,t.status="success",t.message="L'op\xe9ration s'est deroul\xe9e avec succ\xe8s !",t.getAmount(),!0}).catch(function(e){return t.isSend=!0,t.status="danger",console.log(e),t.message=e.error.message,!1})]);case 1:return n.sent(),setTimeout(function(){t.logger.isOk=!1},3e3),[2]}})})},e.prototype.dateToTimestamp=function(e){return e.getTime()},e.prototype.formatDate=function(e){return new Date(e).toLocaleString()},e.ctorParameters=function(){return[{type:p.c},{type:w},{type:b.a}]},e=r.c([Object(o.n)({selector:"app-offre-financement",template:n("Ceb0"),styles:[n("6wu/")]}),r.f("design:paramtypes",[p.c,w,b.a])],e)}(),C=function(){function e(e){return Object.assign(this,e)}return e.ctorParameters=function(){return[{type:void 0}]},e}(),k=function(){function e(e,t,n,r,o,i,s){this.offreFinancementService=e,this.demandeFinancementService=t,this.route=n,this.formBuilder=r,this.router=o,this.modalService=i,this.userService=s,this.couvertures=[],this.periode=0,this.isSend=!1,this.message="",this.status="success",this.modalOptions={backdrop:"static",backdropClass:"customBackdrop",size:"lg"}}return e.prototype.initForm=function(){this.periodeForm=this.formBuilder.group({periode:""})},e.prototype.initRemForm=function(){this.rembourserForm=this.formBuilder.group({montant:""})},e.prototype.ngOnInit=function(){return r.b(this,void 0,void 0,function(){var e;return r.e(this,function(t){return e=this.route.snapshot.paramMap.get("id"),this.getUser(e),this.initForm(),this.initRemForm(),[2]})})},e.prototype.openRemboursement=function(e,t){var n=this;this.couvre=t,this.modalService.open(e,this.modalOptions).result.then(function(e){n.closeResult="Closed with: "+e},function(e){n.closeResult="Dismissed "+n.getDismissReason(e)})},e.prototype.getAccount=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.userService.getCurrentAccount(this.user.idUtilisateur).then(function(t){return e.compte=t,!0}).catch(function(e){return alert("Problem to get compte from database "),!1})];case 1:return t.sent(),[2]}})})},e.prototype.getDismissReason=function(e){return e===a.a.ESC?"by pressing ESC":e===a.a.BACKDROP_CLICK?"by clicking on a backdrop":"with: "+e},e.prototype.getUser=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.userService.getCurrentUser().then(function(n){return t.currentUserId=n.idUtilisateur,t.user=n,t.getAccount(),t.getDemande(e),!0}).catch(function(e){return alert("Problem to get User from database "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})})},e.prototype.getNumberPeriode=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.demandeFinancementService.getNumberPeriode(e).then(function(e){t.numberPeriode=e})];case 1:return n.sent(),[2]}})})},Object.defineProperty(e.prototype,"form",{get:function(){return this.periodeForm.controls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formRem",{get:function(){return this.rembourserForm.controls},enumerable:!0,configurable:!0}),e.prototype.onClose=function(){this.isSend=!1},e.prototype.getDemande=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.demandeFinancementService.fetchDemandeFinancement(e).then(function(n){n.utilisateur.idUtilisateur!=t.currentUserId&&t.router.navigate(["funding/demandeFinancement"]),t.demandeFinancement=n,t.fetchPropositionOffreFinancement(e),t.getNumberPeriode(t.demandeFinancement.idDemandeFinancement)})];case 1:return n.sent(),[2]}})})},e.prototype.parPeriode=function(){return r.b(this,void 0,void 0,function(){return r.e(this,function(e){return parseInt(this.form.periode.value+0)>this.numberPeriode&&(this.isSend=!0,this.status="danger",this.message="Le nombre de periode de la demande a ete depasse !"),this.periode=parseInt(this.form.periode.value+0),this.fetchPropositionOffreFinancementPeriode(this.demandeFinancement.idDemandeFinancement,parseInt(this.form.periode.value+0)),[2]})})},e.prototype.fetchPropositionOffreFinancement=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.offreFinancementService.fetchPropositionOffreFinancement(e).then(function(e){t.offresFinancement=e,t.fetchCouvertures(t.demandeFinancement.idDemandeFinancement)}).catch(function(e){return alert("Problem to get All proposition Financement "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})})},e.prototype.fetchPropositionOffreFinancementPeriode=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.e(this,function(r){switch(r.label){case 0:return[4,this.offreFinancementService.fetchPropositionOffreFinancementPeriode(e,t).then(function(e){n.offresFinancementPeriode=e}).catch(function(e){return alert("Problem to get All proposition Financement "+JSON.stringify(e)),!1})];case 1:return r.sent(),[2]}})})},e.prototype.isCovered=function(e,t){var n=[];return this.couvertures!==[]&&null!=e&&(n=this.couvertures.filter(function(n){return n.offre.idOffre==e.idOffre&&n.periode==t})),n.length>0},e.prototype.fetchCouvertures=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.demandeFinancementService.fetchCouverture(e).then(function(e){t.couvertures=e}).catch(function(e){return alert("Problem to get All DemandeFinancement "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})})},e.prototype.annulerOffre=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.offreFinancementService.deleteCouvre(e.idCouvre).then(function(e){t.fetchPropositionOffreFinancement(t.demandeFinancement.idDemandeFinancement),0!=t.periode&&t.fetchPropositionOffreFinancementPeriode(t.demandeFinancement.idDemandeFinancement,t.periode)}).catch(function(e){return alert("Problem to get All proposition Financement "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})})},e.prototype.onRem=function(){return r.b(this,void 0,void 0,function(){var e,t=this;return r.e(this,function(n){switch(n.label){case 0:return this.formRem.montant.value>this.compte.solde?(alert("Le solde de votre compte est insuffisant !"),[2]):((e=new C(this.couvre)).montantVerse+=this.formRem.montant.value,[4,this.offreFinancementService.rembourserCouvre(e,this.compte.idCompte,this.formRem.montant.value).then(function(e){alert("Remboursement effectu\xe9 avec succ\xe8s !"),t.fetchPropositionOffreFinancement(t.demandeFinancement.idDemandeFinancement)}).catch(function(e){return alert("Erreur lors du remboursement !"),!1})]);case 1:return n.sent(),[2]}})})},e.prototype.validerOffre=function(e,t){return r.b(this,void 0,void 0,function(){var n,o=this;return r.e(this,function(r){switch(r.label){case 0:return n=new C({idCouvre:null,offre:new O({idOffre:e.idOffre}),demandeFinancement:this.demandeFinancement,montantVerse:0,dureeAmortissement:this.getNumberOfDays(),remuneration:e.remuneration,baseRemuneration:e.montant+e.remuneration,tauxJourRemuneration:null,dateRemboursement:new Date(parseInt(this.demandeFinancement.dateOuverture)+this.getNumberOfDays()*t*1e3*60*60*24),nanti:!1,accepte:!0,periode:t}),[4,this.offreFinancementService.validerOffre(n).then(function(e){alert("Offre confirm\xe9e avec succ\xe8s !"),0!=o.periode&&o.fetchPropositionOffreFinancementPeriode(o.demandeFinancement.idDemandeFinancement,o.periode),o.fetchPropositionOffreFinancement(o.demandeFinancement.idDemandeFinancement)}).catch(function(e){return alert("Erreur lors de la selection de l'offre"),!1})];case 1:return r.sent(),[2]}})})},e.prototype.nantirCouvre=function(e){return r.b(this,void 0,void 0,function(){var t,n=this;return r.e(this,function(r){switch(r.label){case 0:return(t=new C(e)).nanti=!0,[4,this.offreFinancementService.nantirCouvre(t,this.compte.idCompte).then(function(e){alert("Offre confirm\xe9e avec succ\xe8s !"),n.getAccount(),n.fetchPropositionOffreFinancement(n.demandeFinancement.idDemandeFinancement)}).catch(function(e){return console.log(e),alert("Erreur lors de la selection de l'offre"),!1})];case 1:return r.sent(),[2]}})})},e.prototype.formatDate=function(e){return new Date(e).toLocaleString()},e.prototype.getNumberOfDays=function(){var e=0;switch(this.demandeFinancement.typeAmortissement.codeValue){case"Jours":e=1;break;case"Mois":e=30;break;case"Annee":e=365}return parseInt(this.demandeFinancement.periodeAmortissement)*e},e.prototype.dateToTimestamp=function(e){return e.getTime()},e.ctorParameters=function(){return[{type:w},{type:v.a},{type:f.a},{type:p.c},{type:f.c},{type:a.b},{type:b.a}]},e=r.c([Object(o.n)({selector:"app-proposition-offre",template:n("HRzy"),styles:[n("ZGPs")]}),r.f("design:paramtypes",[w,v.a,f.a,p.c,f.c,a.b,b.a])],e)}(),S=n("wgzn"),D=n("EW6Q"),I=[{path:"",component:m,children:[{path:"demandeFinancement",component:g},{path:"mes-comptes",component:S.a},{path:"creation-compte",component:D.a},{path:"offreFinancement",component:P},{path:"PropositionsOffresFinancement/:id",component:k}]}],A=function(){function e(){}return e=r.c([Object(o.M)({imports:[f.e.forChild(I)],exports:[f.e]})],e)}();n.d(t,"FundingModule",function(){return U});var U=function(){function e(){}return e=r.c([Object(o.M)({declarations:[m,g,P,k,S.a,D.a],imports:[i.b,p.l,s.a,c.N,c.l,a.c.forRoot(),c.j,c.L,c.h,c.u,c.y,c.G,c.K,c.p.forRoot(),c.g,c.m,c.o.forRoot(),c.Q.forRoot(),A]})],e)}()},s0HC:function(e,t){e.exports='<div class="row">\n  <div class="col">\n    <nb-card>\n      <nb-card-body>        \n        <nb-tabset fullWidth>\n\n          \x3c!-- Demander un financement --\x3e\n          <nb-tab tabTitle="Demander" tabIcon="nb-compose">\n            <form [formGroup]="demandeFinancementForm" (ngSubmit)="envoieDemandeFinancement()">\n              <nb-alert class="bottom col-md-12" status="{{ status }}" *ngIf="isSend" fullWidth closable (close)="onClose()">\n                {{ message }}\n              </nb-alert>\n              <div class="row">\n                <div class="field col-md-6">\n                  <label>Date d\'ouverture</label>\n                  <div class="control">\n                    <input formControlName="dateOuverture" [nbDatepicker]="dateOuverture" nbInput>\n                    <nb-datepicker #dateOuverture></nb-datepicker>\n                  </div>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>Date de cl\xf4ture</label>\n                  <div class="control">\n                    <input formControlName="dateCloture" [nbDatepicker]="dateCloture" nbInput>\n                    <nb-datepicker #dateCloture></nb-datepicker>\n                  </div>\n                </div>\n              </div> \n\n              <div class="row">\n                <div class="field col-md-6">\n                  <label>Montant</label>\n                  <div class="control">\n                    <input type="number" formControlName="montant" min="0" nbInput>\n                  </div>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>R\xe9mun\xe9ration</label>\n                  <div class="control">\n                    <input type="number" formControlName="remuneration" nbInput>\n                  </div>\n                </div>\n              </div>\n\n              <div class="row">\n                <div class="field col-md-4">\n                  <label>Dur\xe9e d\'amortissement</label>\n                  <div class="control">\n                    <input type="number" formControlName="dureeAmortissement" min="1" nbInput>\n                  </div>\n                </div>\n\n\n                <div class="field col-md-4" >\n                  <label>Type d\'amortissement</label>\n                  <div class="control">\n                    <select class="form-control" formControlName="typeAmortissement" outline status="success" size="medium" style="width: 100%">\n                      <option *ngFor="let type of typeAmortissement" [value]="type.codeValue" >{{type.codeValue}}</option>\n                    </select>\n                  </div>\n                </div>\n\n                <div class="field col-md-4">\n                  <label>P\xe9riode d\'amortissement</label>\n                  <div class="control">\n                    <input type="text" formControlName="periodeAmortissement" nbInput>\n                  </div>                     \n                </div>\n              </div>\n              <button status="success" type="submit" fullWidth  nbButton>\n                Valider\n              </button>\n\n            </form>\n          </nb-tab>\n\n          \x3c!-- Consulter les demandes de financement --\x3e\n          <nb-tab tabTitle="Consulter" tabIcon="nb-lightbulb" >\n            <div class="consult-wrapper mt-4 px-4">\n            \n              <div class="options d-flex align-center mb-4">\n\n                <div class="filter p-2">\n                  <span class="mr-2">Filtrer mes demandes</span>\n                  <nb-checkbox status="success"\n                   (change)="selfFilter = $event.target.checked">\n                  </nb-checkbox>\n                </div>\n\n                <div class="ml-auto">\n                  <button nbButton class="btn-secondary" size="xsmall" shape="round"\n                   (click)="refresh()">\n                    Rafra\xeechir\n                  </button>\n                </div>               \n                \n              </div>\n\n              <div class="data table-responsive" *ngIf="demandesFinancement">\n                <table class="table table-hover table-bordered">\n                  \n                  <thead>\n                    <tr>\n                      <th scope="col">#</th>\n                      <th scope="col">Auteur</th>\n                      <th scope="col">Ouverture</th>\n                      <th scope="col">Clot\xfbre</th>\n                      <th scope="col">Montant</th>\n                      <th scope="col">R\xe9mun\xe9ration</th>\n                      <th scope="col">Amortissement</th>\n                      <th scope="col">Actions</th>\n                    </tr>\n                  </thead>\n\n                  <tbody >\n                    <ng-container *ngFor="let el of demandesFinancement | paginate: { itemsPerPage: defaultPageSize, currentPage: currentPage + 1 }">\n\n                      <tr *ngIf="(!selfFilter || (el.utilisateur.idUtilisateur === currentUserId)) && el.utilisateur != null">\n                        <th scope="row">{{ el.idDemandeFinancement }}</th>\n                        <td>{{ el.utilisateur.prenomUtilisateur }}  {{ el.utilisateur.nomUtilisateur }}</td>\n                        <td>{{ formatDate(el.dateOuverture) }}</td>\n                        <td>{{ formatDate(el.dateCloture) }}</td>\n                        <td class="text-right">{{ el.montant.toLocaleString(\'fr\') }}</td>\n                        <td class="text-right">{{ el.remuneration.toLocaleString(\'fr\') }}</td>\n                        <td class="text-right">{{ el.dureeAmortissement + " " + el.typeAmortissement.codeValue }}</td>\n\n                        <td class="actions text-center">\n                          <a nbButton class="btn-secondary" size="xsmall" shape="round" *ngIf="el.utilisateur.idUtilisateur == currentUserId"\n                           [routerLink]="[\'/pfm/funding/PropositionsOffresFinancement\', el.idDemandeFinancement]">\n                            Etablir un contrat\n                          </a>\n                        </td>\n                      </tr>\n                      \n                    </ng-container>\n                  </tbody>\n                </table>\n\n                <nav class="pagination-wrapper d-flex justify-content-around py-3">\n                  <ul class="pagination mb-0 pl-0">\n                    <li class="page-item" [ngClass]="{disabled: currentPage <= 0}">\n                      <a class="page-link" (click)="loadPage(currentPage - 1)" aria-label="Previous">\n                        <span aria-hidden="true">&laquo;</span>\n                        <span class="sr-only">Previous</span>\n                      </a>\n                    </li>\n\n                    <li *ngFor="let page of arrayRange(totalPages)"\n                     class="page-item" [ngClass]="{active: currentPage == page}">\n                      <a class="page-link" (click)="loadPage(page)">{{ page + 1 }}</a>\n                    </li>\n\n                    <li class="page-item" [ngClass]="{disabled: currentPage >= totalPages - 1}">\n                      <a class="page-link" (click)="loadPage(currentPage + 1)" aria-label="Next">\n                        <span aria-hidden="true">&raquo;</span>\n                        <span class="sr-only">Next</span>\n                      </a>\n                    </li>\n                  </ul>\n                </nav>\n\n              </div>\n  \n            </div>\n          </nb-tab>\n\n        </nb-tabset>\n      </nb-card-body>\n    </nb-card>\n  </div>\n</div>\n    '}}]);