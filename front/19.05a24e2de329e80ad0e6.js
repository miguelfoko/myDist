(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"5IAk":function(e,n){e.exports="<router-outlet></router-outlet>\n"},"6wu/":function(e,n){e.exports="form {\n  padding-top: 2rem;\n  padding-bottom: 1rem;\n  max-width: 700px;\n  margin: auto; }\n  form .field {\n    margin-bottom: 2rem; }\n  form .field label {\n      font-size: 90%;\n      display: block; }\n  form .field .control, form .field .control input {\n      width: 100%; }\n  form .field nb-select ::ng-deep [nbButton] {\n      height: 46px;\n      border-color: #dadfe6;\n      text-transform: capitalize; }\n  .consult-wrapper .options .filter {\n  font-size: 90%;\n  border-radius: 5px;\n  border: 1px solid #ebeff5; }\n  .consult-wrapper .options .filter, .consult-wrapper .options .filter * {\n    display: -webkit-box;\n    display: flex;\n    -webkit-box-align: center;\n            align-items: center; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep label {\n    padding: 0; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep .customised-control-description {\n    display: none; }\n  .consult-wrapper .data {\n  font-size: 85%; }\n  .consult-wrapper .data tr:hover {\n    background-color: #f8fafd; }\n  .consult-wrapper .data thead tr:hover {\n    background-color: transparent; }\n  .consult-wrapper .data th, .consult-wrapper .data td {\n    vertical-align: middle; }\n  .consult-wrapper .options .btn-secondary, .consult-wrapper .data .actions .btn-secondary {\n  cursor: pointer; }\n  .consult-wrapper .options .btn-secondary:hover, .consult-wrapper .data .actions .btn-secondary:hover {\n    color: #ffffff;\n    background-color: #40dc7e; }\n"},H2qN:function(e,n){e.exports='<div class="row">\n  <div class="col">\n    <nb-card>\n      <nb-card-body>        \n        <nb-tabset fullWidth>\n\n          \x3c!-- Offrir un financement --\x3e\n          <nb-tab tabTitle="Offrir" tabIcon="nb-heart">\n            <form [formGroup]="form" (ngSubmit)="onSubmit()">\n              <nb-alert class="bottom col-md-12" status="{{ status }}" *ngIf="isSend" fullWidth closable (close)="onClose()">\n                {{ message }}\n              </nb-alert>\n              <div class="row">\n\n                <div class="field col-md-12">\n                  <label>Vous disposez de {{ montantDispo }} Euro disponible</label>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>Date d\'\xe9mission </label>\n                  <div class="control">\n                    <input formControlName="dateEmission" [nbDatepicker]="dateEmission" nbInput/>\n                    <nb-datepicker #dateEmission></nb-datepicker>\n                  </div>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>Date de cl\xf4ture </label>\n                  <div class="control">\n                    <input formControlName="dateCloture" [nbDatepicker]="dateCloture" nbInput/>\n                    <nb-datepicker #dateCloture></nb-datepicker>\n                  </div>\n                </div>\n              </div>\n\n              <div class="row">\n                <div class="field col-md-6">\n                  <label>Montant </label>\n                  <div class="control">\n                    <input type="number" formControlName="montant" min="0" nbInput>\n                  </div>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>R\xe9mun\xe9ration </label>\n                  <div class="control">\n                    <input type="number" formControlName="remuneration" nbInput/>\n                  </div>\n                </div>\n              </div>\n\n              <div class="row">\n                  <div class="field col-md-6">\n                      <div class="filter p-2 control">\n                        <span class="mr-2">L\'offre est-elle secable ?</span>\n                        <nb-checkbox status="success" formControlName="secable">\n                        </nb-checkbox>\n                      </div>\n                  </div>\n  \n                  <div class="field col-md-6">\n                      <div class="filter p-2 control">\n                        <span class="mr-2">L\'offre est-elle extensible ?</span>\n                        <nb-checkbox status="success" formControlName="extensible">\n                        </nb-checkbox>\n                      </div>\n                  </div>\n              </div>\n              <button status="success" type="submit"\n               fullWidth nbButton>\n                Valider\n              </button>\n\n            </form>\n          </nb-tab>\n\n          \x3c!-- Consulter les offres de financement --\x3e\n          <nb-tab tabTitle="Consulter" tabIcon="nb-lightbulb">\n            <div class="consult-wrapper mt-4 px-4">\n            \n              <div class="options d-flex align-center mb-4">\n\n                <div class="ml-auto">\n                  <button nbButton class="btn-secondary" size="xsmall" shape="round"\n                   (click)="fetchMyOffers()">\n                    Rafra\xeechir\n                  </button>\n                </div>               \n                \n              </div>\n\n              <div class="data table-responsive" >\n                <table class="table table-hover table-bordered">\n                  \n                  <thead>\n                    <tr>\n                      <th scope="col">#</th>\n                      <th scope="col">Date d\'\xe9mission</th>\n                      <th scope="col">Date de cloture</th>\n                      <th scope="col">Montant</th>\n                      <th scope="col">R\xe9mun\xe9ration</th>\n                      <th scope="col">Secable</th>\n                      <th scope="col">Extensible</th>\n                      <th scope="col">Actions</th>\n                    </tr>\n                  </thead>\n\n                  <tbody>\n                    <ng-container *ngFor="let offer of offers">\n\n                      <tr>\n                        <th scope="row">{{ offer.idOffreFinancement }}</th>\n                        <td>{{ formatDate(offer.dateEmission) }}</td>\n                        <td>{{ formatDate(offer.dateCloture) }}</td>\n                        <td class="text-right">{{ offer.montant.toLocaleString(\'fr\') }}</td>\n                        <td class="text-right">{{ offer.remuneration.toLocaleString(\'fr\') }}</td>\n                        <td>{{ offer.secable ? \'Oui\' : \'Non\' }}</td>\n                        <td>{{ offer.extensible ? \'Oui\' : \'Non\' }}</td>\n\n                        <td class="actions text-center">\n                          <a nbButton class="btn-secondary" size="xsmall" shape="round" [routerLink]="[\'/pfm/funding/couverture\', offer.idOffreFinancement]">\n                            Couvertures\n                          </a>\n                        </td>\n\n                      </tr>\n                      \n                    </ng-container>\n                  </tbody>\n                </table>\n              </div>\n  \n            </div>\n          </nb-tab>\n\n        </nb-tabset>\n      </nb-card-body>\n    </nb-card>\n  </div>\n</div>\n    '},Hyii:function(e,n){e.exports='<div class="row">\n    <div class="col">\n      <nb-card>\n        <nb-card-body>        \n          <nb-tabset fullWidth>\n\n  \n            \x3c!-- Consulter les demandes de financement --\x3e\n            <nb-tab tabTitle="Proposition d\'offres de financement" tabIcon="nb-lightbulb">\n              <div class="consult-wrapper mt-4 px-4">\n              \n                <div class="options d-flex align-center mb-4">\n             \n                  \n                </div>\n  \n                <div class="data table-responsive" *ngIf="offresFinancement">\n                  <table class="table table-hover table-bordered">\n                    \n                    <thead>\n                      <tr>\n                        <th scope="col" class="text-center">Periode</th>\n                        <th scope="col" class="text-center">Auteur</th>\n                        <th scope="col" class="text-center">Ouverture</th>\n                        <th scope="col" class="text-center">Clot\xfbre</th>\n                        <th scope="col" class="text-center">Montant</th>\n                        <th scope="col" class="text-center">R\xe9mun\xe9ration</th>\n                        <th scope="col" class="text-center">S\xe9cable</th>\n                        <th scope="col" class="text-center">Extensible</th>\n                        <th scope="col" class="text-center">Actions</th>\n                      </tr>\n                    </thead>\n  \n                    <tbody>\n                      <ng-container *ngFor="let el of offresFinancement; let i = index">\n  \n                        <tr *ngIf="(!selfFilter || (el.utilisateur.idUtilisateur === currentUserId)) && !isCovered(el, i+1) && el != null" style="background-color: #8be9b773;">\n                          <th scope="row" class="text-center">{{ i+1 }}</th>\n                          <td>{{ el.utilisateur.prenomUtilisateur + " " + el.utilisateur.nomUtilisateur }}</td>\n                          <td>{{ formatDate(el.dateEmission) }}</td>\n                          <td>{{ formatDate(el.dateCloture) }}</td>\n                          <td class="text-right">{{ el.montant.toLocaleString(\'fr\') }}</td>\n                          <td class="text-right">{{ el.remuneration.toLocaleString(\'fr\') }}</td>\n                          <td class="text-center">{{ el.secable ? \'OUI\' : \'NON\' }}</td>\n                          <td class="text-center">{{ el.extensible ? \'OUI\' : \'NON\' }}</td>\n  \n                          <td class="actions text-center">\n                            <button nbButton class="btn-secondary" (click)="validerOffre(el, i+1)" size="xsmall" shape="round">\n                              Valider\n                            </button>\n                          </td>\n                        </tr>\n                      </ng-container>\n                    </tbody>\n                  </table>\n                </div>\n                <div class="data table-responsive" *ngIf="!offresFinancement">\n                    <h1 class="text-center">Aucune combinaison d\'offres de financement a proposer</h1>\n                </div>\n    \n              </div>\n            </nb-tab>\n\n            <nb-tab tabTitle="Selection d\'offres de financement" tabIcon="nb-lightbulb">\n              <form [formGroup]="periodeForm" (ngSubmit)="parPeriode()">\n                <nb-alert class="bottom col-md-12" status="{{ status }}" *ngIf="isSend" fullWidth closable (close)="onClose()">\n                  {{ message }}\n                </nb-alert>\n                <div class="row">\n                  <div class="field col-md-12" fullWidth>\n                    <label>Numero de la periode</label>\n                    <div class="control" fullWidth>\n                      <input type="number" min="1" max="{{ numberPeriode }}" step="1" fullWidth formControlName="periode" nbInput>\n                    </div>\n                  </div>\n                  <div class="field col-md-12" fullWidth>\n                    <div class="control" fullWidth>\n                      <button status="success" type="submit" fullWidth nbButton>\n                        Rechercher\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </form>\n\n              <div class="data table-responsive" *ngIf="offresFinancementPeriode">\n                <table class="table table-hover table-bordered">\n                  \n                  <thead>\n                    <tr>\n                      <th scope="col" class="text-center">Auteur</th>\n                      <th scope="col" class="text-center">Ouverture</th>\n                      <th scope="col" class="text-center">Clot\xfbre</th>\n                      <th scope="col" class="text-center">Montant</th>\n                      <th scope="col" class="text-center">R\xe9mun\xe9ration</th>\n                      <th scope="col" class="text-center">S\xe9cable</th>\n                      <th scope="col" class="text-center">Extensible</th>\n                      <th scope="col" class="text-center">Actions</th>\n                    </tr>\n                  </thead>\n\n                  <tbody>\n                    <ng-container *ngFor="let el of offresFinancementPeriode">\n\n                      <tr *ngIf="(!selfFilter || (el.utilisateur.idUtilisateur === currentUserId)) && !isCovered(el, periode)">\n                        <td>{{ el.utilisateur.prenomUtilisateur + " " + el.utilisateur.nomUtilisateur }}</td>\n                        <td>{{ formatDate(el.dateEmission) }}</td>\n                        <td>{{ formatDate(el.dateCloture) }}</td>\n                        <td class="text-right">{{ el.montant.toLocaleString(\'fr\') }}</td>\n                        <td class="text-right">{{ el.remuneration.toLocaleString(\'fr\') }}</td>\n                        <td class="text-center">{{ el.secable ? \'OUI\' : \'NON\' }}</td>\n                        <td class="text-center">{{ el.extensible ? \'OUI\' : \'NON\' }}</td>\n\n                        <td class="actions text-center">\n                          <button nbButton class="btn-secondary" (click)="validerOffre(el, periode)" size="xsmall" shape="round">\n                            Valider\n                          </button>\n                        </td>\n                      </tr>\n                    </ng-container>\n                  </tbody>\n                </table>\n              </div>\n            </nb-tab>\n  \n            <nb-tab tabTitle="Etat du contrat de la demande" tabIcon="nb-list">\n              <div class="consult-wrapper mt-4 px-4">\n              \n                <div class="options d-flex align-center mb-4">           \n                  \n                </div>\n  \n                <div class="data table-responsive" *ngIf="offresFinancement">\n                  <table class="table table-hover table-bordered">\n                    \n                    <thead>\n                      <tr>\n                        <th scope="col" class="text-center">Periode</th>\n                        <th scope="col" class="text-center">Ouverture</th>\n                        <th scope="col" class="text-center">Clot\xfbre</th>\n                        <th scope="col" class="text-center">Montant</th>\n                        <th scope="col" class="text-center">R\xe9mun\xe9ration</th>\n                        <th scope="col" class="text-center">Limite de payement</th>\n                        <th scope="col" class="text-center">Actions</th>\n                      </tr>\n                    </thead>\n  \n                    <tbody>\n                      <ng-container *ngFor="let el of couvertures">\n  \n                        <tr *ngIf="!selfFilter || (el.utilisateur.idUtilisateur === currentUserId)">\n                          <th class="text-center" scope="row">{{ el.periode }}</th>\n                          <td class="text-center">{{ formatDate(el.offre.dateEmission) }}</td>\n                          <td class="text-center">{{ formatDate(el.offre.dateCloture) }}</td>\n                          <td class="text-center">{{ el.offre.montant.toLocaleString(\'fr\') }}</td>\n                          <td class="text-center">{{ el.remuneration.toLocaleString(\'fr\') }}</td>\n                          <td class="text-center">{{ formatDate(el.dateRemboursement) }}</td>\n  \n                          <td class="actions text-center">\n                            <button nbButton class="btn-secondary" *ngIf="!el.nanti" sytle="background-color: #d65252" (click)="nantirCouvre(el)" size="xsmall" shape="round">\n                              Nantir\n                            </button>\n                            <button nbButton class="btn-secondary" *ngIf="!el.nanti" sytle="background-color: #d65252" (click)="annulerOffre(el)" size="xsmall" shape="round">\n                              Annuler\n                            </button>\n                            <button nbButton class="btn-secondary" *ngIf="el.nanti && el.montantVerse < el.baseRemuneration"  (click)="openRemboursement(rembourser, el)" sytle="background-color: #d65252" size="xsmall" shape="round">\n                              Rembourser\n                            </button>\n                            <button nbButton class="btn-secondary" *ngIf="el.nanti && el.montantVerse >= el.baseRemuneration" sytle="background-color: #d65252" (click)="annulerOffre(el)" size="xsmall" shape="round">\n                              Supprimer\n                            </button>\n                          </td>\n  \n                        </tr>\n                        \n                      </ng-container>\n                    </tbody>\n                  </table>\n                </div>\n                <div class="data table-responsive" *ngIf="!offresFinancement">\n                    <h1 class="text-center">Aucune combinaison d\'offres de financement a proposer</h1>\n                </div>\n    \n              </div>\n            </nb-tab>\n          </nb-tabset>\n        </nb-card-body>\n      </nb-card>\n    </div>\n  </div>\n      \n\n  <ng-template #rembourser let-modal size="lg">\n    <div class="modal-header">\n        <h4 class="modal-title" id="modal-basic-title">Remboursement de couverture</h4>\n        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss(\'Cross click\')">\n          <span aria-hidden="true">&times;</span>\n        </button>\n    </div>\n    <div class="modal-body" style="min-height: 300px; max-height: 600px; overflow-y: auto;">\n        <p>Vous devez encore rembourser {{ couvre.baseRemuneration - couvre.montantVerse }} Euro</p>\n        <p>Le solde de votre compte est de: {{ compte.solde }} Euro</p>\n        <div class="field modalField col-md-12">\n          <form [formGroup]="rembourserForm" (ngSubmit)="onRem(); modal.close(\'Save click\')">\n            <div class="row">\n              <div class="field col-md-12">\n                <label>Montant a verser </label>\n                <div class="control">\n                  <input type="number" formControlName="montant" nbInput>\n                </div>\n              </div>\n            </div>\n            <button status="success" type="submit" fullWidth nbButton>\n              Valider\n            </button>\n          </form>\n        </div>\n    </div>\n    <div class="modal-footer">\n      <button type="button" class="btn btn-outline-dark" (click)="modal.close(\'Save click\')">Annuler</button>\n    </div>\n  </ng-template>'},IV5l:function(e,n){e.exports="form {\n  padding-top: 2rem;\n  padding-bottom: 1rem;\n  max-width: 700px;\n  margin: auto; }\n  form .field {\n    margin-bottom: 2rem; }\n  form .field label {\n      font-size: 90%;\n      display: block; }\n  form .field .control, form .field .control input {\n      width: 100%; }\n  form .field nb-select ::ng-deep [nbButton] {\n      height: 46px;\n      border-color: #dadfe6;\n      text-transform: capitalize; }\n  .consult-wrapper .options .filter {\n  font-size: 90%;\n  border-radius: 5px;\n  border: 1px solid #ebeff5; }\n  .consult-wrapper .options .filter, .consult-wrapper .options .filter * {\n    display: -webkit-box;\n    display: flex;\n    -webkit-box-align: center;\n            align-items: center; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep label {\n    padding: 0; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep .customised-control-description {\n    display: none; }\n  .consult-wrapper .data {\n  font-size: 85%; }\n  .consult-wrapper .data tr:hover {\n    background-color: #f8fafd; }\n  .consult-wrapper .data thead tr:hover {\n    background-color: transparent; }\n  .consult-wrapper .data th, .consult-wrapper .data td {\n    vertical-align: middle; }\n  .consult-wrapper .data .pagination-wrapper .page-item .page-link:hover {\n    background-color: #f8fafd; }\n  .consult-wrapper .data .pagination-wrapper .page-item.active .page-link {\n    border-color: #3dcc6d;\n    background-color: #3dcc6d; }\n  .consult-wrapper .options .btn-secondary, .consult-wrapper .data .actions .btn-secondary {\n  cursor: pointer; }\n  .consult-wrapper .options .btn-secondary:hover, .consult-wrapper .data .actions .btn-secondary:hover {\n    color: #ffffff;\n    background-color: #40dc7e; }\n"},ZGPs:function(e,n){e.exports="form {\n  padding-top: 2rem;\n  padding-bottom: 1rem;\n  max-width: 700px;\n  margin: auto; }\n  form .field {\n    margin-bottom: 2rem; }\n  form .field label {\n      font-size: 90%;\n      display: block; }\n  form .field .control, form .field .control input {\n      width: 100%; }\n  form .field nb-select ::ng-deep [nbButton] {\n      height: 46px;\n      border-color: #dadfe6;\n      text-transform: capitalize; }\n  .consult-wrapper .options .filter {\n  font-size: 90%;\n  border-radius: 5px;\n  border: 1px solid #ebeff5; }\n  .consult-wrapper .options .filter, .consult-wrapper .options .filter * {\n    display: -webkit-box;\n    display: flex;\n    -webkit-box-align: center;\n            align-items: center; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep label {\n    padding: 0; }\n  .consult-wrapper .options .filter nb-checkbox ::ng-deep .customised-control-description {\n    display: none; }\n  .consult-wrapper .options .btn-secondary {\n  cursor: pointer; }\n  .consult-wrapper .options .btn-secondary:hover {\n    color: #ffffff;\n    background-color: #40dc7e; }\n  .consult-wrapper .options .btn-danger {\n  color: #ffffff;\n  background-color: #d65252; }\n  .consult-wrapper .data {\n  font-size: 85%; }\n  .consult-wrapper .data tr:hover {\n    background-color: #f8fafd; }\n  .consult-wrapper .data thead tr:hover {\n    background-color: transparent; }\n"},bWmn:function(e,n){e.exports=""},icE9:function(e,n,t){"use strict";t.r(n);var r=t("mrSG"),o=t("CcnG"),i=t("Ip0R"),s=t("xkgV"),a=t("4GxJ"),c=t("TtU4"),l=t("ZtdT"),d=function(){function e(){}return e.prototype.ngOnInit=function(){l.replace()},e=r.c([Object(o.n)({selector:"fundingComponent",template:t("5IAk"),styles:[t("bWmn")]}),r.f("design:paramtypes",[])],e)}(),u=t("gIcY"),f=t("ZYCi"),m=function(){return function(e){return Object.assign(this,e)}}(),p=t("qfBg"),b=t("xCfu"),h=function(){function e(e,n,t,r){this.router=e,this.formBuilder=n,this.userService=t,this.demandeFinancementService=r,this.logger={isOk:!1,message:"",color:""},this.isSend=!1,this.message="",this.status="success",this.selfFilter=!1,this.demandesFinancement=[],this.currentPage=0,this.totalPages=0,this.loadedPages=[-1],this.defaultPageSize=10}return e.prototype.ngOnInit=function(){this.getUser(),this.initForm()},e.prototype.getUser=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.userService.getCurrentUser().then(function(n){return e.currentUserId=n.idUtilisateur,e.profile=n,e.fetchDemandesFinancement(0),e.getTypeAmortissement(),!0}).catch(function(e){return console.log("Problem to get User from database "+JSON.stringify(e)),alert("Problem to get User from database "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})})},e.prototype.onClose=function(){this.isSend=!1},e.prototype.initForm=function(){this.demandeFinancementForm=this.formBuilder.group({dateOuverture:"",dateCloture:"",montant:"",dureeAmortissement:"",typeAmortissement:"",periodeAmortissement:"",remuneration:"",titre:"Demande financement",etatFinancement:0,nombreActifEquivalent:0,utilisateur:""})},e.prototype.getTypeAmortissement=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.demandeFinancementService.getTypeAmortissement().then(function(n){return e.typeAmortissement=n,!0}).catch(function(e){return console.log("Problem to get TypeAmortissement "+JSON.stringify(e)),alert("Problem to get TypeAmortissement "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})})},e.prototype.fetchDemandesFinancement=function(e){return void 0===e&&(e=0),r.b(this,void 0,void 0,function(){var n,t,o,i,s=this;return r.e(this,function(a){switch(a.label){case 0:n=Math.max.apply(Math,this.loadedPages),t=function(e){return r.e(this,function(n){switch(n.label){case 0:return[4,o.demandeFinancementService.fetchDemandesFinancement(e,o.defaultPageSize,o.currentUserId).then(function(n){var t;return console.log("Fundings loaded       ",n),(t=s.demandesFinancement).push.apply(t,n.content),s.loadedPages.push(e),0==s.totalPages&&(s.totalPages=n.totalPages),!0}).catch(function(e){return console.log("Problem to get all financements "+JSON.stringify(e)),alert("Problem to get all financements "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})},o=this,i=n+1,a.label=1;case 1:return i<=e?[5,t(i)]:[3,4];case 2:a.sent(),a.label=3;case 3:return++i,[3,1];case 4:return[2]}})})},e.prototype.envoieDemandeFinancement=function(){return r.b(this,void 0,void 0,function(){var e,n=this;return r.e(this,function(t){switch(t.label){case 0:return(e=new m(this.demandeFinancementForm.value)).utilisateur=this.profile,[4,this.demandeFinancementService.addDemandeFinancement(e).then(function(e){return n.logger.message="Offre enregistr\xe9e avec succ\xe8s",n.logger.isOk=!0,n.logger.color="primary",n.initForm(),n.fetchDemandesFinancement(),n.isSend=!0,n.status="success",n.message="L'op\xe9ration s'est deroul\xe9e avec succ\xe8s !",!0}).catch(function(e){return n.isSend=!0,n.status="danger",n.message=e.error.message,!1})];case 1:return t.sent(),[2]}})})},e.prototype.loadPage=function(e){var n=this;this.fetchDemandesFinancement(e).then(function(){n.currentPage=e}).catch(function(){console.error("Couldn't load page",e)})},e.prototype.refresh=function(){this.demandesFinancement=[],this.loadedPages=[-1],this.loadPage(0)},e.prototype.formatDate=function(e){return new Date(e).toLocaleString()},e.prototype.arrayRange=function(e){return Array.from(Array(e).keys())},e=r.c([Object(o.n)({selector:"demandeFinancement",template:t("wz8d"),styles:[t("IV5l")]}),r.f("design:paramtypes",[f.c,u.b,p.a,b.a])],e)}(),v=t("t/Na"),g=t("AytR"),y={headers:new v.d({"Content-Type":"application/json","Access-Control-Allow-Origin":"*"})},x=function(){function e(e){this.http=e,this.url=g.a.serverEndpoint+"/funding/demandes-financements/",this.urlOffreUtilisateur=g.a.serverEndpoint+"/funding/offres",this.urlValidation=g.a.serverEndpoint+"/funding/couvres",this.urlOffresUtilisateur=g.a.serverEndpoint+"/funding/utilisateurs/"}return e.prototype.fetchPropositionOffreFinancement=function(e){return this.http.get(this.url+e+"/proposing",y).toPromise()},e.prototype.fetchPropositionOffreFinancementPeriode=function(e,n){return this.http.get(this.url+e+"/proposing/"+n+"/periode",y).toPromise()},e.prototype.sendOffreFinancement=function(e){return this.http.post(this.urlOffreUtilisateur,e,y).toPromise()},e.prototype.fetchUserOffresFinancement=function(e){return this.http.get(this.urlOffresUtilisateur+e+"/offres",y).toPromise()},e.prototype.validerOffre=function(e){return this.http.post(this.urlValidation,e,y).toPromise()},e.prototype.nantirCouvre=function(e,n){return this.http.put(this.urlValidation+"/"+n,e,y).toPromise()},e.prototype.rembourserCouvre=function(e,n,t){return this.http.post(this.urlValidation+"/rembourser/"+n+"/"+t,e,y).toPromise()},e.prototype.deleteCouvre=function(e){return this.http.delete(this.urlValidation+"/"+e,y).toPromise()},e=r.c([Object(o.C)({providedIn:"root"}),r.f("design:paramtypes",[v.b])],e)}(),F=function(){return function(e){return Object.assign(this,e)}}(),w=function(){function e(e,n,t){this.formBuilder=e,this.offreFinancementService=n,this.userService=t,this.logger={isOk:!1,message:"",color:""},this.selfFilter=!1,this.isSend=!1,this.message="",this.status="success"}return e.prototype.ngOnInit=function(){this.initForm(),this.getUser()},e.prototype.onClose=function(){this.isSend=!1},e.prototype.getUser=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.userService.getCurrentUser().then(function(n){return e.user=n,e.getAccount(),!0}).catch(function(e){return alert("Problem to get User from database "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})})},e.prototype.initForm=function(){this.form=this.formBuilder.group({dateEmission:"",dateCloture:"",montant:"",remuneration:"",secable:"",extensible:"",utilisateur:""})},e.prototype.fetchMyOffers=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.offreFinancementService.fetchUserOffresFinancement(this.user.idUtilisateur).then(function(n){n=n.reverse(),e.offers=n}).catch(function(e){return alert("Problem to get All All Offre Financement "+JSON.stringify(e)),!1})];case 1:return n.sent(),[2]}})})},e.prototype.getAccount=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.userService.getCurrentAccount(this.user.idUtilisateur).then(function(n){return e.compte=n,e.getAmount(),!0}).catch(function(e){return alert("Problem to get compte from database "),!1})];case 1:return n.sent(),[2]}})})},e.prototype.getAmount=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.userService.bgDisponible(this.compte).then(function(n){return e.montantDispo=n,!0}).catch(function(e){return alert("Problem to get amount from database "),!1})];case 1:return n.sent(),[2]}})})},e.prototype.onSubmit=function(){return r.b(this,void 0,void 0,function(){var e,n=this;return r.e(this,function(t){switch(t.label){case 0:return this.form.value.montant>this.montantDispo?(this.isSend=!0,this.status="danger",this.message="Le montant maximal \xe0 proposer a \xe9t\xe9 depass\xe9, veuillez acheter d'autre BGs",[2]):(this.form.value.dateEmission=this.dateToTimestamp(this.form.value.dateEmission),this.form.value.dateCloture=this.dateToTimestamp(this.form.value.dateCloture),(e=new F(this.form.value)).utilisateur=this.user,[4,this.offreFinancementService.sendOffreFinancement(e).then(function(e){return n.logger.message="Offre enregistr\xe9e avec succ\xe8s",n.logger.isOk=!0,n.logger.color="primary",n.initForm(),n.fetchMyOffers(),n.isSend=!0,n.status="success",n.message="L'op\xe9ration s'est deroul\xe9e avec succ\xe8s !",n.getAmount(),!0}).catch(function(e){return n.isSend=!0,n.status="danger",n.message=e.error.message,!1})]);case 1:return t.sent(),setTimeout(function(){n.logger.isOk=!1},3e3),[2]}})})},e.prototype.dateToTimestamp=function(e){return e.getTime()},e.prototype.formatDate=function(e){return new Date(e).toLocaleString()},e=r.c([Object(o.n)({selector:"app-offre-financement",template:t("H2qN"),styles:[t("6wu/")]}),r.f("design:paramtypes",[u.b,x,p.a])],e)}(),O=function(){return function(e){return Object.assign(this,e)}}(),P=function(){function e(e,n,t,r,o,i,s){this.offreFinancementService=e,this.demandeFinancementService=n,this.route=t,this.formBuilder=r,this.router=o,this.modalService=i,this.userService=s,this.couvertures=[],this.periode=0,this.isSend=!1,this.message="",this.status="success",this.modalOptions={backdrop:"static",backdropClass:"customBackdrop",size:"lg"}}return e.prototype.initForm=function(){this.periodeForm=this.formBuilder.group({periode:""})},e.prototype.initRemForm=function(){this.rembourserForm=this.formBuilder.group({montant:""})},e.prototype.ngOnInit=function(){return r.b(this,void 0,void 0,function(){var e;return r.e(this,function(n){return e=this.route.snapshot.paramMap.get("id"),this.getUser(e),this.initForm(),this.initRemForm(),[2]})})},e.prototype.openRemboursement=function(e,n){var t=this;this.couvre=n,this.modalService.open(e,this.modalOptions).result.then(function(e){t.closeResult="Closed with: "+e},function(e){t.closeResult="Dismissed "+t.getDismissReason(e)})},e.prototype.getAccount=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.userService.getCurrentAccount(this.user.idUtilisateur).then(function(n){return e.compte=n,!0}).catch(function(e){return alert("Problem to get compte from database "),!1})];case 1:return n.sent(),[2]}})})},e.prototype.getDismissReason=function(e){return e===a.a.ESC?"by pressing ESC":e===a.a.BACKDROP_CLICK?"by clicking on a backdrop":"with: "+e},e.prototype.getUser=function(e){return r.b(this,void 0,void 0,function(){var n=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.userService.getCurrentUser().then(function(t){return n.currentUserId=t.idUtilisateur,n.user=t,n.getAccount(),n.getDemande(e),!0}).catch(function(e){return alert("Problem to get User from database "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})})},e.prototype.getNumberPeriode=function(e){return r.b(this,void 0,void 0,function(){var n=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.demandeFinancementService.getNumberPeriode(e).then(function(e){n.numberPeriode=e})];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"form",{get:function(){return this.periodeForm.controls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formRem",{get:function(){return this.rembourserForm.controls},enumerable:!0,configurable:!0}),e.prototype.onClose=function(){this.isSend=!1},e.prototype.getDemande=function(e){return r.b(this,void 0,void 0,function(){var n=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.demandeFinancementService.fetchDemandeFinancement(e).then(function(t){t.utilisateur.idUtilisateur!=n.currentUserId&&n.router.navigate(["funding/demandeFinancement"]),n.demandeFinancement=t,n.fetchPropositionOffreFinancement(e),n.getNumberPeriode(n.demandeFinancement.idDemandeFinancement)})];case 1:return t.sent(),[2]}})})},e.prototype.parPeriode=function(){return r.b(this,void 0,void 0,function(){return r.e(this,function(e){return parseInt(this.form.periode.value+0)>this.numberPeriode&&(this.isSend=!0,this.status="danger",this.message="Le nombre de periode de la demande a ete depasse !"),this.periode=parseInt(this.form.periode.value+0),this.fetchPropositionOffreFinancementPeriode(this.demandeFinancement.idDemandeFinancement,parseInt(this.form.periode.value+0)),[2]})})},e.prototype.fetchPropositionOffreFinancement=function(e){return r.b(this,void 0,void 0,function(){var n=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.offreFinancementService.fetchPropositionOffreFinancement(e).then(function(e){n.offresFinancement=e,n.fetchCouvertures(n.demandeFinancement.idDemandeFinancement)}).catch(function(e){return alert("Problem to get All proposition Financement "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})})},e.prototype.fetchPropositionOffreFinancementPeriode=function(e,n){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(r){switch(r.label){case 0:return[4,this.offreFinancementService.fetchPropositionOffreFinancementPeriode(e,n).then(function(e){t.offresFinancementPeriode=e,console.log(e)}).catch(function(e){return alert("Problem to get All proposition Financement "+JSON.stringify(e)),!1})];case 1:return r.sent(),[2]}})})},e.prototype.isCovered=function(e,n){var t=[];return this.couvertures!==[]&&null!=e&&(t=this.couvertures.filter(function(t){return t.offre.idOffre==e.idOffre&&t.periode==n})),t.length>0},e.prototype.fetchCouvertures=function(e){return r.b(this,void 0,void 0,function(){var n=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.demandeFinancementService.fetchCouverture(e).then(function(e){n.couvertures=e,console.log(e)}).catch(function(e){return alert("Problem to get All DemandeFinancement "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})})},e.prototype.annulerOffre=function(e){return r.b(this,void 0,void 0,function(){var n=this;return r.e(this,function(t){switch(t.label){case 0:return[4,this.offreFinancementService.deleteCouvre(e.idCouvre).then(function(e){n.fetchPropositionOffreFinancement(n.demandeFinancement.idDemandeFinancement),0!=n.periode&&n.fetchPropositionOffreFinancementPeriode(n.demandeFinancement.idDemandeFinancement,n.periode)}).catch(function(e){return alert("Problem to get All proposition Financement "+JSON.stringify(e)),!1})];case 1:return t.sent(),[2]}})})},e.prototype.onRem=function(){return r.b(this,void 0,void 0,function(){var e,n=this;return r.e(this,function(t){switch(t.label){case 0:return this.formRem.montant.value>this.compte.solde?(alert("Le solde de votre compte est insuffisant !"),[2]):((e=new O(this.couvre)).montantVerse+=this.formRem.montant.value,[4,this.offreFinancementService.rembourserCouvre(e,this.compte.idCompte,this.formRem.montant.value).then(function(e){alert("Remboursement effectu\xe9 avec succ\xe8s !"),n.fetchPropositionOffreFinancement(n.demandeFinancement.idDemandeFinancement)}).catch(function(e){return alert("Erreur lors du remboursement !"),!1})]);case 1:return t.sent(),[2]}})})},e.prototype.validerOffre=function(e,n){return r.b(this,void 0,void 0,function(){var t,o=this;return r.e(this,function(r){switch(r.label){case 0:return t=new O({idCouvre:null,offre:new F({idOffre:e.idOffre}),demandeFinancement:this.demandeFinancement,montantVerse:0,dureeAmortissement:this.getNumberOfDays(),remuneration:e.remuneration,baseRemuneration:e.montant+e.remuneration,tauxJourRemuneration:null,dateRemboursement:new Date(parseInt(this.demandeFinancement.dateOuverture)+this.getNumberOfDays()*n*1e3*60*60*24),nanti:!1,accepte:!0,periode:n}),[4,this.offreFinancementService.validerOffre(t).then(function(e){alert("Offre confirm\xe9e avec succ\xe8s !"),0!=o.periode&&o.fetchPropositionOffreFinancementPeriode(o.demandeFinancement.idDemandeFinancement,o.periode),o.fetchPropositionOffreFinancement(o.demandeFinancement.idDemandeFinancement)}).catch(function(e){return alert("Erreur lors de la selection de l'offre"),!1})];case 1:return r.sent(),[2]}})})},e.prototype.nantirCouvre=function(e){return r.b(this,void 0,void 0,function(){var n,t=this;return r.e(this,function(r){switch(r.label){case 0:return(n=new O(e)).nanti=!0,[4,this.offreFinancementService.nantirCouvre(n,this.compte.idCompte).then(function(e){alert("Offre confirm\xe9e avec succ\xe8s !"),t.getAccount(),t.fetchPropositionOffreFinancement(t.demandeFinancement.idDemandeFinancement)}).catch(function(e){return console.log(e),alert("Erreur lors de la selection de l'offre"),!1})];case 1:return r.sent(),[2]}})})},e.prototype.formatDate=function(e){return new Date(e).toLocaleString()},e.prototype.getNumberOfDays=function(){var e=0;switch(this.demandeFinancement.typeAmortissement.codeValue){case"Jours":e=1;break;case"Mois":e=30;break;case"Annee":e=365}return parseInt(this.demandeFinancement.periodeAmortissement)*e},e.prototype.dateToTimestamp=function(e){return e.getTime()},e=r.c([Object(o.n)({selector:"app-proposition-offre",template:t("Hyii"),styles:[t("ZGPs")]}),r.f("design:paramtypes",[x,b.a,f.a,u.b,f.c,a.b,p.a])],e)}(),k=[{path:"",component:d,children:[{path:"demandeFinancement",component:h},{path:"offreFinancement",component:w},{path:"PropositionsOffresFinancement/:id",component:P}]}],C=function(){function e(){}return e=r.c([Object(o.K)({imports:[f.d.forChild(k)],exports:[f.d]})],e)}();t.d(n,"FundingModule",function(){return S});var S=function(){function e(){}return e=r.c([Object(o.K)({declarations:[d,h,w,P],imports:[i.b,u.f,s.a,c.y,c.f,a.c.forRoot(),c.e,c.x,c.c,c.m,c.o,c.t,c.w,c.j.forRoot(),c.b,c.g,c.i.forRoot(),c.A.forRoot(),C]})],e)}()},wz8d:function(e,n){e.exports='<div class="row">\n  <div class="col">\n    <nb-card>\n      <nb-card-body>        \n        <nb-tabset fullWidth>\n\n          \x3c!-- Demander un financement --\x3e\n          <nb-tab tabTitle="Demander" tabIcon="nb-compose">\n            <form [formGroup]="demandeFinancementForm" (ngSubmit)="envoieDemandeFinancement()">\n              <nb-alert class="bottom col-md-12" status="{{ status }}" *ngIf="isSend" fullWidth closable (close)="onClose()">\n                {{ message }}\n              </nb-alert>\n              <div class="row">\n                <div class="field col-md-6">\n                  <label>Date d\'ouverture</label>\n                  <div class="control">\n                    <input formControlName="dateOuverture" [nbDatepicker]="dateOuverture" nbInput>\n                    <nb-datepicker #dateOuverture></nb-datepicker>\n                  </div>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>Date de cl\xf4ture</label>\n                  <div class="control">\n                    <input formControlName="dateCloture" [nbDatepicker]="dateCloture" nbInput>\n                    <nb-datepicker #dateCloture></nb-datepicker>\n                  </div>\n                </div>\n              </div>\n\n              <div class="row">\n                <div class="field col-md-6">\n                  <label>Montant</label>\n                  <div class="control">\n                    <input type="number" formControlName="montant" min="0" nbInput>\n                  </div>\n                </div>\n\n                <div class="field col-md-6">\n                  <label>R\xe9mun\xe9ration</label>\n                  <div class="control">\n                    <input type="number" formControlName="remuneration" nbInput>\n                  </div>\n                </div>\n              </div>\n\n              <div class="row">\n                <div class="field col-md-4">\n                  <label>Dur\xe9e d\'amortissement</label>\n                  <div class="control">\n                    <input type="number" formControlName="dureeAmortissement" min="1" nbInput>\n                  </div>\n                </div>\n\n\n                <div class="field col-md-4" >\n                  <label>Type d\'amortissement</label>\n                  <div class="control">\n                    <nb-select formControlName="typeAmortissement" outline status="success">\n                      <nb-option *ngFor="let type of typeAmortissement" [value]="type">\n                        {{type.codeValue}}\n                      </nb-option>\n                    </nb-select>\n                  </div>\n                </div>\n\n                <div class="field col-md-4">\n                  <label>P\xe9riode d\'amortissement</label>\n                  <div class="control">\n                    <input type="text" formControlName="periodeAmortissement" nbInput>\n                  </div>                     \n                </div>\n              </div>\n              <button status="success" type="submit" fullWidth\n               nbButton>\n                Valider\n              </button>\n\n            </form>\n          </nb-tab>\n\n          \x3c!-- Consulter les demandes de financement --\x3e\n          <nb-tab tabTitle="Consulter" tabIcon="nb-lightbulb" >\n            <div class="consult-wrapper mt-4 px-4">\n            \n              <div class="options d-flex align-center mb-4">\n\n                <div class="filter p-2">\n                  <span class="mr-2">Filtrer mes demandes</span>\n                  <nb-checkbox status="success"\n                   (change)="selfFilter = $event.target.checked">\n                  </nb-checkbox>\n                </div>\n\n                <div class="ml-auto">\n                  <button nbButton class="btn-secondary" size="xsmall" shape="round"\n                   (click)="refresh()">\n                    Rafra\xeechir\n                  </button>\n                </div>               \n                \n              </div>\n\n              <div class="data table-responsive" *ngIf="demandesFinancement">\n                <table class="table table-hover table-bordered">\n                  \n                  <thead>\n                    <tr>\n                      <th scope="col">#</th>\n                      <th scope="col">Auteur</th>\n                      <th scope="col">Ouverture</th>\n                      <th scope="col">Clot\xfbre</th>\n                      <th scope="col">Montant</th>\n                      <th scope="col">R\xe9mun\xe9ration</th>\n                      <th scope="col">Amortissement</th>\n                      <th scope="col">Actions</th>\n                    </tr>\n                  </thead>\n\n                  <tbody >\n                    <ng-container *ngFor="let el of demandesFinancement | paginate: { itemsPerPage: defaultPageSize, currentPage: currentPage + 1 }">\n\n                      <tr *ngIf="(!selfFilter || (el.utilisateur.idUtilisateur === currentUserId)) && el.utilisateur != null">\n                        <th scope="row">{{ el.idDemandeFinancement }}</th>\n                        <td>{{ el.utilisateur.prenomUtilisateur }}  {{ el.utilisateur.nomUtilisateur }}</td>\n                        <td>{{ formatDate(el.dateOuverture) }}</td>\n                        <td>{{ formatDate(el.dateCloture) }}</td>\n                        <td class="text-right">{{ el.montant.toLocaleString(\'fr\') }}</td>\n                        <td class="text-right">{{ el.remuneration.toLocaleString(\'fr\') }}</td>\n                        <td class="text-right">{{ el.dureeAmortissement + " " + el.typeAmortissement.codeValue }}</td>\n\n                        <td class="actions text-center">\n                          <a nbButton class="btn-secondary" size="xsmall" shape="round" *ngIf="el.utilisateur.idUtilisateur == currentUserId"\n                           [routerLink]="[\'/pfm/funding/PropositionsOffresFinancement\', el.idDemandeFinancement]">\n                            Etablir un contrat\n                          </a>\n                        </td>\n                      </tr>\n                      \n                    </ng-container>\n                  </tbody>\n                </table>\n\n                <nav class="pagination-wrapper d-flex justify-content-around py-3">\n                  <ul class="pagination mb-0 pl-0">\n                    <li class="page-item" [ngClass]="{disabled: currentPage <= 0}">\n                      <a class="page-link" (click)="loadPage(currentPage - 1)" aria-label="Previous">\n                        <span aria-hidden="true">&laquo;</span>\n                        <span class="sr-only">Previous</span>\n                      </a>\n                    </li>\n\n                    <li *ngFor="let page of arrayRange(totalPages)"\n                     class="page-item" [ngClass]="{active: currentPage == page}">\n                      <a class="page-link" (click)="loadPage(page)">{{ page + 1 }}</a>\n                    </li>\n\n                    <li class="page-item" [ngClass]="{disabled: currentPage >= totalPages - 1}">\n                      <a class="page-link" (click)="loadPage(currentPage + 1)" aria-label="Next">\n                        <span aria-hidden="true">&raquo;</span>\n                        <span class="sr-only">Next</span>\n                      </a>\n                    </li>\n                  </ul>\n                </nav>\n\n              </div>\n  \n            </div>\n          </nb-tab>\n\n        </nb-tabset>\n      </nb-card-body>\n    </nb-card>\n  </div>\n</div>\n    '}}]);